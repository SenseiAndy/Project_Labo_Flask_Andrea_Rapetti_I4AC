{% extends "base.html" %}
{% block title %}Register - Emotion Explorer{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h3 class="card-title text-center mb-4">Register</h3>
                    <form id="userForm" onsubmit="submitForm(event)" style="background: #f8f9fa;">
                        <div class="mb-3" id="emailSection">
                            <label for="email" class="form-label">Email:</label>
                            <input type="email" id="email" name="email" class="form-control" required autofocus>
                        </div>
                        <div class="mb-3" id="usernameSection">
                            <label for="username" class="form-label">Username:</label>
                            <input type="text" id="username" name="username" class="form-control" required>
                        </div>
                        <div class="mb-3" id="passwordSection">
                            <label for="password" class="form-label">Password:</label>
                            <input type="password" id="password" name="password" class="form-control" required>
                        </div>
                        <div class="mb-3" id="confirmPasswordSection">
                            <label for="confirmPassword" class="form-label">Confirm Password:</label>
                            <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Submit</button>
                        <pre id="output" class="mt-3 text-danger text-center"></pre>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
function submitForm(event) {
    event.preventDefault();
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirmPassword").value;
    if (password !== confirmPassword) {
        document.getElementById("output").innerText = "Passwords do not match.";
        return;
    }
    const formData = {
        email: document.getElementById("email").value,
        username: document.getElementById("username").value,
        password: password
    };

    const xhr = new XMLHttpRequest();
    xhr.open("POST", "/submit", true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onload = function () {
        if (xhr.status === 201) {
            window.location.href = "/auth/login";
        } else {
            let msg = "Error submitting data.";
            try {
                const response = JSON.parse(xhr.responseText);
                if (response.error) msg = response.error;
            } catch {}
            document.getElementById("output").innerText = msg;
        }
    };
    xhr.send(JSON.stringify(formData));
}
</script>
{% endblock %}
